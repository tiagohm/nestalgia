package br.tiagohm.nestalgia.core

import org.slf4j.LoggerFactory
import java.io.IOException

object MapperFactory {

    const val FDS_MAPPER_ID = 65535

    @JvmStatic private val LOG = LoggerFactory.getLogger(MapperFactory::class.java)

    @JvmStatic
    fun from(console: Console, data: RomData): Mapper {
        return when (val id = data.info.mapperId) {
            0 -> NROM(console)
            1 -> MMC1(console)
            2 -> UNROM(console)
            3 -> Mapper003(console)
            4 -> if (data.info.subMapperId == 3) McAcc(console) else MMC3(console)
            6 -> Mapper006(console)
            7 -> AXROM(console)
            8 -> Mapper008(console)
            9 -> MMC2(console)
            10 -> MMC4(console)
            11 -> ColorDreams(console)
            12 -> Mapper012(console)
            13 -> CpRom(console)
            14 -> Mapper014(console)
            15 -> Mapper015(console)
            16 -> Mapper016(console)
            17 -> Mapper017(console)
            18 -> JalecoSs88006(console)
            28 -> Action53(console)
            29 -> SealieComputing(console)
            30 -> UNROM512(console)
            31 -> NsfCart31(console)
            33 -> TaitoTc0190(console)
            34 -> {
                when (val sid = data.info.subMapperId) {
                    // BnROM uses CHR RAM (so no CHR rom in the NES file)
                    0 -> if (data.chrRom.isEmpty()) BnROM(console) else Nina01(console)
                    1 -> Nina01(console)
                    2 -> BnROM(console)
                    else -> throw IOException("unsupported mapper $id with submapper $sid")
                }
            }
            35 -> Mapper035(console)
            36 -> Txc22000(console)
            37 -> Mapper037(console)
            38 -> UnlPci556(console)
            39 -> Mapper039(console)
            40 -> Mapper040(console)
            42 -> Mapper042(console)
            44 -> Mapper044(console)
            45 -> Mapper045(console)
            46 -> ColorDreams46(console)
            47 -> Mapper047(console)
            49 -> Mapper049(console)
            52 -> Mapper052(console)
            62 -> Mapper062(console)
            63 -> Bmc63(console)
            66 -> GxROM(console)
            71 -> BF909x(console)
            72 -> JalecoJF17AndJF19(console, false)
            73 -> VRC3(console)
            74 -> Mapper074(console)
            76 -> Mapper076(console)
            75 -> VRC1(console)
            77 -> IremLrog017(console)
            78 -> JalecoJF16(console)
            79 -> Nina0306(console, false)
            80 -> TaitoX1005(console, false)
            87 -> Mapper087(console)
            86 -> JalecoJF13(console)
            88 -> Mapper088(console)
            91 -> Mapper091(console)
            92 -> JalecoJF17AndJF19(console, true)
            94 -> UNROM94(console)
            95 -> Mapper095(console)
            96 -> OekaKids(console)
            97 -> IremTamS1(console)
            99 -> VsSystem(console)
            101 -> Mapper101(console)
            103 -> Mapper103(console)
            104 -> GoldenFive(console)
            105 -> Mapper105(console)
            106 -> Mapper106(console)
            107 -> Mapper107(console)
            108 -> Bb(console)
            111 -> Cheapocabra(console)
            112 -> Mapper112(console)
            113 -> Nina0306(console, true)
            114 -> Mapper114(console)
            115 -> Mapper115(console)
            118 -> TxSRom(console)
            119 -> Mapper119(console)
            121 -> Mapper121(console)
            123 -> Mapper123(console)
            132 -> Txc22211a(console)
            133 -> Sachen133(console)
            134 -> Mapper134(console)
            136 -> Sachen136(console)
            137 -> Sachen8259(console, Sachen8259.SACHEN_8259_D)
            138 -> Sachen8259(console, Sachen8259.SACHEN_8259_B)
            139 -> Sachen8259(console, Sachen8259.SACHEN_8259_C)
            140 -> JalecoJF11AndJF14(console)
            141 -> Sachen8259(console, Sachen8259.SACHEN_8259_A)
            143 -> Sachen143(console)
            144 -> Mapper144(console)
            145 -> Sachen145(console)
            146 -> Nina0306(console, false)
            147 -> Sachen147(console)
            148 -> Sachen148(console)
            149 -> Sachen149(console)
            150 -> Sachen74LS374N(console)
            153 -> Mapper153(console)
            154 -> Mapper154(console)
            155 -> Mapper155(console)
            156 -> DaouInfosys(console)
            157 -> Mapper157(console)
            159 -> Mapper159(console)
            162 -> Waixing162(console)
            164 -> Waixing164(console)
            172 -> Txc22211b(console)
            173 -> Txc22211c(console)
            175 -> Kaiser7022(console)
            177 -> Henggedianzi177(console)
            178 -> Waixing178(console)
            179 -> Henggedianzi179(console)
            180 -> UNROM180(console)
            185 -> Mapper185(console)
            190 -> MagicKidGooGoo(console)
            191 -> Mapper191(console)
            192 -> Mapper192(console)
            194 -> Mapper194(console)
            195 -> Mapper195(console)
            196 -> Mapper196(console)
            197 -> Mapper197(console)
            198 -> Mapper198(console)
            199 -> Mapper199(console)
            200 -> Mapper200(console)
            206 -> Namco108(console)
            207 -> TaitoX1005(console, true)
            213 -> Mapper213(console)
            214 -> Mapper214(console)
            218 -> MagicFloor218(console)
            219 -> Mapper219(console)
            222 -> Mapper222(console)
            232 -> BF9096(console)
            235 -> Bmc235(console)
            238 -> Mapper238(console)
            240 -> Mapper240(console)
            241 -> Mapper241(console)
            242 -> Mapper242(console)
            243 -> Sachen74LS374N(console)
            244 -> Mapper244(console)
            245 -> Mapper245(console)
            246 -> Mapper246(console)
            249 -> Mapper249(console)
            250 -> Mapper250(console)
            252 -> Waixing252(console)
            253 -> Mapper253(console)
            254 -> Mapper254(console)
            255 -> Bmc255(console)
            286 -> Bs5(console)
            290 -> BmcNtd03(console)
            328 -> Rt01(console)
            346 -> Kaiser7012(console)
            348 -> Bmc830118C(console)
            513 -> Sachen9602(console)
            FDS_MAPPER_ID -> Fds(console)
            32770 -> Gs2013(console)
            else -> {
                LOG.error("{} has unsupported mapper id={}", data.info.name, id)
                throw IOException("Unsupported mapper $id")
            }
        }
    }
}
